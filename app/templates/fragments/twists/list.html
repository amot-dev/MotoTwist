{% for twist in twists %}
<li id="twist-item-{{ twist.id }}"
    class="twist-item scroll-shut-on-delete"
    data-twist-id="{{ twist.id }}"
    data-paved="{{ twist.is_paved }}">

    <header class="twist-header"
        hx-get="/twists/{{ twist.id }}/templates/dropdown"
        hx-ext="morph"
        hx-target="next .twist-dropdown"
        hx-swap="morph:innerHTML"
        hx-trigger="loadDropdown">

        <span class="twist-name">{{ twist.name }}</span>
        <span>
            {% if twist.viewer_is_author %}
            <i class="fa-solid fa-user"></i>
            {% else %}
            <i class="fa-regular fa-user"></i>
            {% endif %}
        </span>
        <span class="visibility-toggle" title="Toggle visibility">
            <i class="far fa-eye"></i>
        </span>
    </header>
    {% if twist.id == open_twist_id %}
    <div class="twist-dropdown is-open">
        {% include "fragments/twists/dropdown.html" %}
    </div>
    {% else %}
    <div class="twist-dropdown">
        <p class="loading">Loading...</p>
    </div>
    {% endif %}
</li>
{% endfor %}

{# Calculate the sliding window boundaries #}
{% set window_size = 2 %}
{% set page_start = [2, current_page - window_size] | max %}
{% set page_end = [total_pages - 1, current_page + window_size] | min %}

<li id="twist-list-pagination" data-current-page="{{ current_page }}">
    <!-- Prev Button -->
    <button class="pagination-arrow"
            hx-get="/twists/templates/list"
            hx-ext="morph"
            hx-target="#twist-list"
            hx-swap="morph:innerHTML"
            hx-include="closest aside .filter-form"
            hx-vals='{"page": {{ current_page - 1 }} }'
            {% if current_page == 1 %}disabled{% endif %}>
        <i class="fa-solid fa-chevron-left"></i>
    </button>

    <!-- First Page -->
    <button class="pagination-number {% if current_page == 1 %}is-current{% endif %}"
            hx-get="/twists/templates/list"
            hx-ext="morph"
            hx-target="#twist-list"
            hx-swap="morph:innerHTML"
            hx-include="closest aside .filter-form"
            hx-vals='{"page": 1}'>
        1
    </button>

    <!-- Ellipsis after first page -->
    {% if page_start > 2 %}
        <span class="pagination-ellipsis">&hellip;</span>
    {% endif %}

    <!-- Sliding Window of pages -->
    {% for i in range(page_start, page_end + 1) %}
    <button class="pagination-number {% if i == current_page %}is-current{% endif %}"
            hx-get="/twists/templates/list"
            hx-ext="morph"
            hx-target="#twist-list"
            hx-swap="morph:innerHTML"
            hx-include="closest aside .filter-form"
            hx-vals='{"page": {{ i }} }'>
        {{ i }}
    </button>
    {% endfor %}

    <!-- Ellipsis before last page -->
    {% if page_end < total_pages - 1 %}
    <span class="pagination-ellipsis">&hellip;</span>
    {% endif %}

    <!-- Last Page -->
    {% if total_pages > 1 %}
    <button class="pagination-number {% if current_page == total_pages %}is-current{% endif %}"
            hx-get="/twists/templates/list"
            hx-ext="morph"
            hx-target="#twist-list"
            hx-swap="morph:innerHTML"
            hx-include="closest aside .filter-form"
            hx-vals='{"page": {{ total_pages }} }'>
        {{ total_pages }}
    </button>
    {% endif %}

    <!-- Next Button -->
    <button class="pagination-arrow"
            hx-get="/twists/templates/list"
            hx-ext="morph"
            hx-target="#twist-list"
            hx-swap="morph:innerHTML"
            hx-include="closest aside .filter-form"
            hx-vals='{"page": {{ current_page + 1 }} }'
            {% if current_page == total_pages %}disabled{% endif %}>
        <i class="fa-solid fa-chevron-right"></i>
    </button>
</li>
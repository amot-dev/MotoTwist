<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twisties</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
        integrity="sha512-h9FcoyWjHcOcmEVkxOfTLnmZFWIH0iZhZT1H2TbOq55xssQGEJHEaIm+PgoUaZbRvQTNTluNOEfb1ZRy6D3BOw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">
</head>
{% if new_twist %}
    <body data-new-twist="{{ new_twist }}">
{% else %}
    <body>
{% endif %}

    {% if flash %}
    <div class="flash-message">
        {{ flash }}
    </div>
    {% endif %}

    <div id="sidebar">
        <div id="twist-list-container">
            <h1>Twists</h1>
            <button id="openCreateTwistModal" data-modal-target="#createTwistModal">Create New Twist</button>

            <ul id="twist-list">
                {% for twist in twists %}
                <li class="twist-item" data-twist-id="{{ twist.id }}" data-paved="{{ twist.is_paved }}">
                    <div class="twist-header">
                        <span class="twist-name">{{ twist.name }}</span>
                        <span class="visibility-toggle" title="Toggle visibility">
                            <i class="far fa-eye"></i>
                        </span>
                    </div>
                    <div class="ratings-container">
                        <h4>Average Rating</h4>
                        <button class="open-rate-twist-modal" data-modal-target="#rateTwistModal" data-twist-id="{{ twist.id }}">Rate</button>
                        <ul></ul>
                        <a href="#" class="open-twist-ratings-modal" data-modal-target="#viewTwistRatingsModal" data-twist-id="{{ twist.id }}">See all</a>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div id="map"></div>

    <div id="createTwistModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h1>Create a New Twist</h1>
            
            <form action="/twists/create" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="modal-name">Twist Name</label>
                    <input type="text" id="modal-name" name="name" required>
                </div>

                <div class="form-group">
                    <fieldset>
                        <legend>Surface Type</legend>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="is_paved" value="true" checked> Paved
                            </label>
                            <label>
                                <input type="radio" name="is_paved" value="false"> Unpaved
                            </label>
                        </div>
                    </fieldset>
                </div>

                <div class="form-group">
                    <label for="modal-file">GPX File</label>
                    <input type="file" id="modal-file" name="file" accept=".gpx" required>
                </div>

                <div class="button-group">
                    <button type="button" class="cancel-button">Cancel</button>
                    <button type="submit">Create Twist</button>
                </div>
            </form>
        </div>
    </div>

    <div id="rateTwistModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h1>Rate Twist</h1>
            
            <form action="" method="post" data-action-template="/twists/{id}/rate">
                <div class="form-group">
                    <label for="rating_date">Rating Date</label>
                    <input type="date" id="rating_date" name="rating_date" required>
                </div>

                <div id="paved-criteria" class="criteria-group" style="display: none;">
                    {% for criteria in rating_critera_paved %}
                    <div class="form-group slider-group">
                        <label for="{{ criteria }}">{{ criteria | capitalize }}</label>
                        <input type="range" id="{{ criteria }}" name="{{ criteria }}" min="1" max="10" value="5">
                        <span class="slider-value">5</span>
                    </div>
                    {% endfor %}
                </div>

                <div id="unpaved-criteria" class="criteria-group" style="display: none;">
                    {% for criteria in rating_critera_unpaved %}
                    <div class="form-group slider-group">
                        <label for="{{ criteria }}">{{ criteria | capitalize }}</label>
                        <input type="range" id="{{ criteria }}" name="{{ criteria }}" min="1" max="10" value="5">
                        <span class="slider-value">5</span>
                    </div>
                    {% endfor %}
                </div>

                <div class="button-group">
                    <button type="button" class="cancel-button">Cancel</button>
                    <button type="submit">Submit Rating</button>
                </div>
            </form>
        </div>
    </div>

    <div id="viewTwistRatingsModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h1>Twist Ratings</h1>
            <div id="ratings-list-container">
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"
        integrity="sha512-puJW3E/qXDqYp9IfhAI54BJEaWIfloJ7JWs7OeD5i6ruC9JZL1gERT1wjtwXFlh7CjE7ZJ+/vcRZRkIYIb6p4g=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/2.2.0/gpx.min.js"
        integrity="sha512-i9cfK7mcbURqnNfNFYqNhB4/Ae5xAgrrGFPgRnVB5Ws6Xac3BbYqFwtMbyf3QZW8Nq+F7gcWGsM0HUyoA/RVIw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer">
    </script>
    <script src="{{ url_for('static', path='/js/script.js') }}"></script>
</body>
</html>
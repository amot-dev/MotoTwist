{% extends "base.html" %}
{% from "fragments/_macros.html" import render_modal_content, render_form_buttons %}

{% block body_attributes %}
    {% if new_twist %}data-new-twist="{{ new_twist }}"{% endif %}
{% endblock %}

{% block content %}
    <div class="flash-message"></div>

    <div id="sidebar">
        <div id="twist-list-container">
            <h1>MotoTwist</h1>
            <a href="#modal-create-twist" class="button open-modal-create-twist">New Twist</a>

            <ul id="twist-list" hx-get="/twists" hx-trigger="load" hx-swap="innerHTML">
                <p>Loading twists...</p>
            </ul>
        </div>
    </div>

    <div id="map"></div>

    <div id="modal-create-twist" class="modal">
        {% call render_modal_content("New Twist") %}
            <form hx-post="/twists/create"
                hx-target="#twist-list"
                hx-swap="innerHTML"
                hx-on::after-request="location.hash = ''; this.reset()"
                enctype="multipart/form-data">
                <div class="form-group">
                    <label for="modal-name">Twist Name</label>
                    <input type="text" id="modal-name" name="name" required>
                </div>

                <div class="form-group">
                    <fieldset>
                        <legend>Surface Type</legend>
                        <div class="radio-group">
                            <label><input type="radio" name="is_paved" value="true" checked> Paved</label>
                            <label><input type="radio" name="is_paved" value="false"> Unpaved</label>
                        </div>
                    </fieldset>
                </div>

                <div class="form-group">
                    <label for="modal-file">GPX File</label>
                    <input type="file" id="modal-file" name="file" accept=".gpx" required>
                </div>

                {{ render_form_buttons(submit_text="Submit Rating") }}
            </form>
        {% endcall %}
    </div>

    <div id="modal-rate-twist" class="modal modal-dynamic">
        <p>Loading form...</p>
    </div>

    <div id="modal-view-twist-ratings" class="modal modal-dynamic">
        <p>Loading ratings...</p>
    </div>
{% endblock %}